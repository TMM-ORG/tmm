# Story 1.1: Project Setup & Reddit Integration

## Status
Draft

## Story
**As a** developer,
**I want** to set up the Next.js project and connect to the Reddit API,
**so that** I can fetch the top 10 posts from any given subreddit.

## Acceptance Criteria

1. Next.js 15+ project is initialized with TypeScript 5.8+ and App Router configuration
2. Project follows the defined directory structure with `/app`, `/services`, and proper organization
3. Supabase client is initialized and configured with environment variables
4. Reddit API integration service can authenticate using OAuth2 (app-only authentication)
5. Service can fetch top 10 hot posts from any public subreddit
6. Fetched posts include: title, author, score, num_comments, created_utc, selftext, and permalink
7. Error handling for invalid subreddit names and API failures
8. TypeScript interfaces defined for Reddit API responses
9. Environment variables properly configured in `.env.local`
10. Basic unit tests for Reddit service functionality
11. Vercel deployment configuration setup with environment variables
12. CI/CD pipeline configured for automated deployment from main branch

## Tasks / Subtasks

- [ ] Initialize Next.js project with TypeScript (AC: 1, 2)
  - [ ] Run `npx create-next-app@latest` with TypeScript and App Router
  - [ ] Configure TypeScript with strict mode
  - [ ] Set up project structure following architecture specs
  - [ ] Configure `.gitignore` for Next.js project

- [ ] Set up Supabase integration (AC: 3, 9)
  - [ ] Install Supabase client dependencies
  - [ ] Create `.env.local` with Supabase configuration
  - [ ] Initialize Supabase client in `/lib/supabase.ts`
  - [ ] Add type definitions for Supabase

- [ ] Implement Reddit OAuth2 authentication (AC: 4, 9)
  - [ ] Create Reddit app at https://www.reddit.com/prefs/apps
  - [ ] Add Reddit credentials to `.env.local`
  - [ ] Implement OAuth2 app-only flow in `/services/reddit/auth.ts`
  - [ ] Create token management and refresh logic

- [ ] Create Reddit API service (AC: 5, 6, 7, 8)
  - [ ] Define TypeScript interfaces for Reddit API responses in `/types/reddit.ts`
  - [ ] Implement `fetchTopPosts()` function in `/services/reddit/client.ts`
  - [ ] Add error handling for network failures and invalid subreddits
  - [ ] Implement rate limiting compliance (60 requests per minute)

- [ ] Create API endpoint for testing (AC: 5, 7)
  - [ ] Create `/app/api/reddit/posts/route.ts`
  - [ ] Implement GET handler that accepts subreddit parameter
  - [ ] Add validation and error responses

- [ ] Write unit tests (AC: 10)
  - [ ] Set up Jest configuration for Next.js
  - [ ] Write tests for Reddit authentication service
  - [ ] Write tests for post fetching functionality
  - [ ] Mock external API calls

- [ ] Configure Vercel deployment (AC: 11, 12)
  - [ ] Install Vercel CLI globally: `npm i -g vercel`
  - [ ] Run `vercel` command to link project and deploy
  - [ ] Set environment variables via `vercel env add`
  - [ ] Test deployment with `vercel --prod`
  - [ ] Configure automatic deployments from Git integration

## Dev Notes

### Project Structure
Based on architecture document, the project structure should be:
```
/app
  /api
    /reddit
      /posts
        route.ts    # API endpoint for fetching posts
    /generate
      route.ts      # Future: main video generation endpoint
/services
  /reddit
    auth.ts         # OAuth2 authentication
    client.ts       # Reddit API client
/lib
  supabase.ts      # Supabase client initialization
/types
  reddit.ts        # TypeScript interfaces for Reddit
```

### Tech Stack Implementation
- **Framework**: Next.js 15+ with App Router
- **Language**: TypeScript 5.8+
- **Backend Platform**: Supabase (latest)
- **Testing**: Jest for unit tests

### Reddit API Details
- Use Reddit's OAuth2 "Application Only" flow for server-side authentication
- Base URL: `https://oauth.reddit.com`
- Rate limit: 60 requests per minute
- User-Agent header required: Format as `<platform>:<app ID>:<version> (by /u/<reddit username>)`

### Environment Variables Required
```env
# Supabase
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key

# Reddit API
REDDIT_CLIENT_ID=your_reddit_client_id
REDDIT_CLIENT_SECRET=your_reddit_client_secret
REDDIT_USER_AGENT=your_app_user_agent
```

### Key TypeScript Interfaces
```typescript
interface RedditPost {
  id: string;
  title: string;
  author: string;
  score: number;
  num_comments: number;
  created_utc: number;
  selftext: string;
  permalink: string;
  subreddit: string;
}

interface RedditApiResponse {
  data: {
    children: Array<{
      data: RedditPost;
    }>;
  };
}
```

### Testing Standards
- Test files location: Adjacent to source files with `.test.ts` extension
- Use Jest with `@testing-library/react` for component tests
- Mock external API calls to avoid rate limits
- Minimum coverage: 80% for services

### Vercel Deployment (CLI Approach)
```bash
# Install Vercel CLI globally
npm i -g vercel

# Initial deployment and project linking
vercel

# Add environment variables
vercel env add NEXT_PUBLIC_SUPABASE_URL production
vercel env add NEXT_PUBLIC_SUPABASE_ANON_KEY production
vercel env add SUPABASE_SERVICE_ROLE_KEY production
vercel env add REDDIT_CLIENT_ID production
vercel env add REDDIT_CLIENT_SECRET production
vercel env add REDDIT_USER_AGENT production

# Deploy to production
vercel --prod

# Enable Git integration for automatic deployments
# (Done via Vercel dashboard - connects GitHub repo)
```

### Automatic Deployment Setup
1. Connect GitHub repository via Vercel dashboard
2. Enable automatic deployments on push to main branch
3. Preview deployments automatically created for pull requests
4. No additional CI/CD configuration needed - Vercel handles it all

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-09-29 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

### Agent Model Used
_To be populated by dev agent_

### Debug Log References
_To be populated by dev agent_

### Completion Notes List
_To be populated by dev agent_

### File List
_To be populated by dev agent_

## QA Results
_To be populated by QA agent_